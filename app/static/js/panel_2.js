let globalSellerImage,goodCovers=[],goodDetailImages=[],cCount0=0,cCount1=0,globalConfig={template:{good_name:"短袖T恤女白色夏天潮流爆款个性绝美韩版气质遮肉显瘦上衣打底衫",price_0:269,price_1:259,warehouses:"广东广州仓发货",seller_name:"海外旗舰店",seller_image:"",product_covers:[],product_images:[],sold_count:""},pay_channel:"p0",timeout:60,magic:!0,lock:!1};function download_config(){const e=JSON.stringify(globalConfig,null,4),t=new Blob([e],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download="template_params.json",n.click(),URL.revokeObjectURL(n.href)}function load_config(){const e=document.getElementById("config_file");e.click(),e.addEventListener("change",()=>{const t=e.files[0];if(t){const e=new FileReader;e.addEventListener("load",e=>{const t=e.target.result,n=JSON.parse(t);globalConfig=n,goodCovers=n.template.product_covers,goodDetailImages=n.template.product_images,globalSellerImage=n.template.seller_image;const a=document.getElementById("template_param_id_0"),o=document.getElementById("template_param_id_1"),l=document.getElementById("template_param_id_2"),c=document.getElementById("template_param_id_3"),d=document.getElementById("template_param_id_4"),i=document.getElementById("security_setting_id_1"),m=document.getElementById("security_setting_id_0");a.value=n.template.good_name,o.value=n.template.price_0,l.value=n.template.price_1,d.value=n.template.seller_name,c.value=n.template.warehouses,m.value=n.timeout,i.checked=n.magic,cCount0++}),e.readAsText(t)}})}function uploadGoodCovers(){const e=document.getElementById("template_param_id_6");e.click(),e.addEventListener("change",e=>{const t=e.target.files,n=[];for(let e=0;e<t.length;e++){const a=t[e],o=new FileReader;o.onload=(e=>{const t=e.target.result;n.push(t)}),o.readAsDataURL(a)}goodCovers=n,cCount0++})}function uploadDetailImages(){const e=document.getElementById("template_param_id_7");e.click(),e.addEventListener("change",e=>{const t=e.target.files,n=[];for(let e=0;e<t.length;e++){const a=t[e],o=new FileReader;o.onload=(e=>{const t=e.target.result;n.push(t)}),o.readAsDataURL(a)}goodDetailImages=n,cCount0++})}function uploadSellerImage(){const e=document.getElementById("template_param_id_5");e.click(),e.addEventListener("change",e=>{const t=e.target.files[0],n=new FileReader;n.onload=(e=>{const t=e.target.result;globalSellerImage=t}),n.readAsDataURL(t),cCount0++})}function close_result(){document.getElementById("create_result").style.display="none"}setInterval(()=>{try{const e=document.getElementById("template_param_id_0"),t=document.getElementById("template_param_id_1"),n=document.getElementById("template_param_id_2"),a=document.getElementById("template_param_id_3"),o=document.getElementById("template_param_id_4"),l=document.getElementById("security_setting_id_1"),c=document.getElementById("security_setting_id_0"),d=document.getElementById("template_param_sold"),i=document.getElementById("pay_channels"),m=document.getElementById("security_setting_id_2"),r={goodName:e.value,price_0:t.value,price_1:n.value,address:a.value,sellerName:o.value,sellerImage:globalSellerImage,goodCovers:goodCovers,goodDetailImages:goodDetailImages,sold_count:d.value,pay_channel:i.value};globalConfig.template.good_name=r.goodName,globalConfig.template.price_0=r.price_0,globalConfig.template.price_1=r.price_1,globalConfig.template.warehouses=r.address,globalConfig.template.seller_name=r.sellerName,globalConfig.template.seller_image=r.sellerImage,globalConfig.template.product_covers=r.goodCovers,globalConfig.template.product_images=r.goodDetailImages,globalConfig.timeout=c.value||60,globalConfig.magic=l.checked,globalConfig.template.sold_count=d.value,globalConfig.pay_channel=i.value,globalConfig.lock=m.checked;const s=document.getElementById("template_preview");s.contentWindow.postMessage(r),cCount0!=cCount1&&(s.className="w-auto h-auto",cCount1=cCount0,setTimeout(()=>{s.className="w-full h-full"},20))}catch(e){}},200);let processing_order=!1;function create_order(){const e=document.getElementById("create_order_button");if(processing_order)return alert("处理中......"),-1;processing_order=!0,e.innerHTML="处理中...";const t={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(globalConfig)};fetch("/api/v1/create_order",t).then(e=>e.json()).then(t=>{if(1==t.code){document.getElementById("create_result").style.display="block",document.getElementById("result_feed_id").innerHTML=t.data.feed_id;const e=document.getElementById("templates");let n=0;"t1"==e.value&&(n=2),"t0"==e.value&&(n=0);const a=document.domain;document.getElementById("result_origin_link").innerHTML=`https://${a}/template/${n}?feed_id=${t.data.feed_id}`}else alert("失败");e.innerHTML="生成一个订单",processing_order=!1}).catch(t=>{alert("错误"),e.innerHTML="生成一个订单",processing_order=!1})}function update_token_a(){const e=document.getElementById("pay_channel_a_auth_token");if(!e.value)return alert("Auth Token is empty!"),-1;const t={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({token:e.value})};fetch("/api/v1/update_token_pay_channel_a",t).then(e=>e.json()).then(e=>{-3==e.code?alert("Auth Token 无效"):1==e.code?alert("更新成功"):alert("更新失败")})}function check_cloud_token_a(){fetch("/api/v1/check_token_a").then(e=>e.json()).then(e=>{1==e.code?alert("有效"):-2==e.code?alert("Token 未设置"):-3==e.code?alert("Token 已失效, 需更新"):alert("错误")})}let last_template=document.getElementById("templates").value;function update_channel_b_info(){const e=document.getElementById("pcb_image"),t=document.getElementById("pcb_name"),n=document.getElementById("pcb_id"),a=document.getElementById("pcb_status");fetch("/api/v1/get_pay_channel_b_info").then(e=>e.json()).then(o=>{1==o.code&&(a.innerHTML="已设置",a.className="text-lime-500",e.src=o.data.headUrl,t.innerHTML=o.data.userName,n.innerHTML=o.data.userId)})}function update_token_b0(){const e=document.getElementById("pay_channel_b_user_id");if(!e.value)return void alert("Empty");const t=`/api/v1/update_pcb_user_id/${e.value}`;fetch(t).then(e=>e.json()).then(e=>{-1==e.code&&alert("错误"),1==e.code&&(alert("成功"),update_channel_b_info()),-2==e.code&&alert("")})}function update_channel_c_info(){const e=document.getElementById("pcc_image"),t=document.getElementById("pcc_name"),n=document.getElementById("pcc_id"),a=document.getElementById("pcc_status");fetch("/api/v1/getPCC_info").then(e=>e.json()).then(o=>{1==o.code&&(a.innerHTML="已设置",a.className="text-lime-500",e.src=o.data.headUrl,t.innerHTML=o.data.nickname,n.innerHTML=o.data.displayId)})}function update_pcc_cookie(){const e=document.getElementById("pay_channel_c_cookie"),t=document.getElementById("pay_channel_c_verify");if(!e.value||!t.value)return void alert("Empty");const n={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({cookie:e.value,verify:t.value})};fetch("/api/v1/update_pcc_cookie",n).then(e=>e.json()).then(e=>{1==e.code&&(alert("成功"),update_channel_c_info()),-2==e.code&&alert("")})}function change_me(e){const t=document.getElementById(`img_${e}`);t.click(),t.addEventListener("change",t=>{const n=t.target.files[0];if(n){const t=new FileReader;t.onload=(t=>{const n=t.target.result;document.getElementById(e).src=n}),t.readAsDataURL(n)}})}function save_card(){html2canvas(document.querySelector("#capture")).then(e=>{document.getElementById("card_img").appendChild(e)})}function randomDelay(){return 2e3*Math.random()}function randomBlinks(){return Math.floor(5*Math.random())+1}function blinkLetter(e){setTimeout(function(){e.style.visibility="hidden",setTimeout(function(){e.style.visibility="visible";const t=randomBlinks();for(let n=0;n<t;n++)setTimeout(function(){blinkLetter(e)},randomDelay())},randomDelay())},randomDelay())}setInterval(()=>{try{const e=document.getElementById("templates");"t1"==e.value&&e.value!=last_template&&(last_template=document.getElementById("templates").value,document.getElementById("template_preview").src="",document.getElementById("template_preview").src="/template/2?feed_id=preview"),"t0"==e.value&&e.value!=last_template&&(last_template=document.getElementById("templates").value,document.getElementById("template_preview").src="",document.getElementById("template_preview").src="/template/0?feed_id=preview")}catch(e){}},400),setInterval(()=>{try{fetch("/api/v1/getLock").then(e=>e.json()).then(e=>{e.locked&&(window.location.reload(),window.location=this.window.location,window.location.href=this.window.location.href)})}catch(e){}},3e3),window.onload=(()=>{update_channel_b_info(),update_channel_c_info()}),document.addEventListener("DOMContentLoaded",function(){update_channel_b_info(),update_channel_c_info();const e=document.getElementById("blinking"),t=e.textContent.split("");e.textContent="",t.forEach(function(t){const n=document.createElement("span");n.textContent=t,e.appendChild(n),blinkLetter(n)})});